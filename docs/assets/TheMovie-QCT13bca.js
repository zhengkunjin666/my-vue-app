import{F as j}from"./base-DWc1T_OZ.js";import{_ as A,E as B,a as $}from"./el-image-viewer-BXMPGTFq.js";import{E as L}from"./el-scrollbar-Bx6k3odp.js";import{E as M,_ as U,a as q}from"./search-wxyzz1CK.js";import{E as R}from"./el-input-DYpg4z5h.js";import{d as D,S as P,o as G,a as H,a8 as J,A as O,r as Q,j as d,M as a,t as n,x as r,Q as K,u as c,l as N,G as W,a5 as X,h as g,F as Y,_ as Z,L as ee}from"./index-D5iT9OGn.js";import{E as b}from"./el-message-nU1Hnnk2.js";const te={class:"z-flex-1 z-flex-col",style:{height:"10%"}},oe={class:"z-m-t-15"},se={id:"scrollbar",class:"z-flex-1 z-m-t-20 z-p-b-20",style:{height:"10%"}},le={class:"list","infinite-scroll-distance":500},ne=["onClick"],ae=a("i",null,null,-1),ie={class:"z-m-t-10 z-m-b-20"},re=["title"],ye=D({__name:"TheMovie",setup(ce){const e=P({pageNum:1,pageSize:40,key:"",list:[],scrollTopValue:0,height:"",isFirst:!0});G(()=>{S(),h(),window.addEventListener("resize",h)}),H(()=>{window.removeEventListener("resize",h)}),J(()=>{E.value.setScrollTop(e.scrollTopValue)});const h=()=>{O(()=>{const o=document.getElementById("scrollbar");e.height=(o==null?void 0:o.getBoundingClientRect().height)+"px"})},z=()=>{e.isFirst||(e.pageNum++,e.key?y(e.key,e.pageNum):S())},S=()=>{const o=`https://pcw-api.iqiyi.com/search/recommend/list?channel_id=1&data_type=1&mode=24&page_id=${e.pageNum}&ret_num=${e.pageSize}`;fetch(o).then(t=>t.json()).then(t=>{console.log("Success:",t),e.pageNum===1&&(e.list=[],u()),e.isFirst=!1,t.data.list.forEach(i=>{i.imageUrl=i.imageUrl.replace(".jpg","_579_772.jpg")}),e.list=e.list.concat(t.data.list)}).catch(t=>{console.error("Error:",t),b.error({message:t,offset:100})})},y=(o,t)=>{if(t||(e.pageNum=1),o){const i=`https://mesh.if.iqiyi.com/portal/lw/search/homePageV3?key=${o}&pageNum=${e.pageNum}&pageSize=40`;fetch(i).then(s=>s.json()).then(s=>{console.log("Success:",s),s.code===0?(e.pageNum===1&&(e.list=[],u()),s.data.templates.forEach((p,v)=>{if(p.intentAlbumInfos&&p.intentAlbumInfos.length>0){const _=[];p.intentAlbumInfos.forEach(m=>{m.img=m.img.replace(".jpg","_579_772.jpg");const f={};f.albumInfo=m,_.push(f)}),s.data.templates.splice(v,1,..._)}}),e.list=e.list.concat(s.data.templates)):b.error({message:"已经到底，没有数据了！",offset:100})}).catch(s=>{console.error("Error:",s),b.error({message:s,offset:100})})}else e.pageNum=0,z()},T=o=>{e.scrollTopValue=o.scrollTop},E=Q(),u=()=>{e.scrollTopValue>0&&(window.requestAnimationFrame(u),E.value.setScrollTop(0))},V=X(),x=o=>{const t=JSON.stringify(o);V.push({name:"play",state:{params:t,type:"iqiyi"}})};return(o,t)=>{const i=U,s=j,p=q,v=R,_=M,m=B,f=L,C=A,F=$;return g(),d("div",te,[a("div",oe,[n(_,{onSubmit:t[3]||(t[3]=K(()=>{},["prevent"]))},{default:r(()=>[n(v,{modelValue:c(e).key,"onUpdate:modelValue":t[1]||(t[1]=l=>c(e).key=l),placeholder:"请输入剧名搜索",clearable:!0,onChange:t[2]||(t[2]=l=>y(l,0))},{append:r(()=>[n(p,{type:"primary",onClick:t[0]||(t[0]=l=>y(c(e).key,0))},{default:r(()=>[n(s,null,{default:r(()=>[n(i)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),a("div",se,[n(f,{ref_key:"scrollbarRef",ref:E,class:"z-p-l-20 z-p-r-20",height:c(e).height,always:"",onScroll:T},{default:r(()=>[N((g(),d("div",le,[(g(!0),d(Y,null,Z(c(e).list,l=>{var k,I,w;return g(),d("div",{class:"item",key:l.title},[a("div",{class:"image",onClick:pe=>x(l)},[n(m,{src:l.imageUrl||((k=l.albumInfo)==null?void 0:k.img),referrerpolicy:"no-referrer",lazy:""},null,8,["src"]),ae],8,ne),a("div",ie,[a("span",{class:"z-line-1",title:l.title||((I=l.albumInfo)==null?void 0:I.title)},ee(l.title||((w=l.albumInfo)==null?void 0:w.title)),9,re)])])}),128))])),[[F,z]])]),_:1},8,["height"])]),N(a("div",{class:"to-top",onClick:u},[n(s,null,{default:r(()=>[n(C)]),_:1})],512),[[W,c(e).scrollTopValue>600]])])}}});export{ye as default};
