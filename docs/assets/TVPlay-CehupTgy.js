import{d as C,r as j,o as B,a as F,b as A,n as $,c as U,e as f,f as a,g as n,w as c,h as L,u as r,i as I,v as R,j as q,k as g,F as D,l as M,t as P}from"./index-EqPcfzUZ.js";import{E as H,a as J,_ as O,b as G,c as K,d as Q,e as W,f as X}from"./search-bWBLf1Oj.js";import{E,a as Y}from"./el-message-PDgxLFWx.js";const Z={class:"z-flex-1 z-flex-col",style:{height:"10%"}},ee={class:"z-m-t-15"},te={id:"scrollbar",class:"z-flex-1 z-m-t-20 z-p-b-20",style:{height:"10%"}},oe={class:"list","infinite-scroll-distance":500},se=["onClick"],le=a("i",null,null,-1),ne={class:"z-m-t-10 z-m-b-20"},ae=["title"],me=C({__name:"TVPlay",setup(ie){const e=j({pageNum:1,pageSize:40,key:"",list:[],scrollTopValue:0,height:"",isFirst:!0});B(()=>{z(),h(),window.addEventListener("resize",h)}),F(()=>{window.removeEventListener("resize",h)}),A(()=>{v.value.setScrollTop(e.scrollTopValue)});const h=()=>{$(()=>{const o=document.getElementById("scrollbar");e.height=(o==null?void 0:o.getBoundingClientRect().height)+"px"})},k=()=>{e.isFirst||(e.pageNum++,e.key?y(e.key,e.pageNum):z())},z=()=>{const o=`https://pcw-api.iqiyi.com/search/recommend/list?channel_id=2&data_type=1&mode=24&page_id=${e.pageNum}&ret_num=${e.pageSize}`;fetch(o).then(t=>t.json()).then(t=>{console.log("Success:",t),e.pageNum===1&&(e.list=[],m()),e.isFirst=!1,t.data.list.forEach(i=>{i.imageUrl=i.imageUrl.replace(".jpg","_579_772.jpg")}),e.list=e.list.concat(t.data.list)}).catch(t=>{console.error("Error:",t),E.error({message:t,offset:100})})},y=(o,t)=>{if(t||(e.pageNum=1),o){const i=`https://mesh.if.iqiyi.com/portal/lw/search/homePageV3?key=${o}&pageNum=${e.pageNum}&pageSize=40`;fetch(i).then(s=>s.json()).then(s=>{console.log("Success:",s),s.code===0?(e.pageNum===1&&(e.list=[],m()),s.data.templates.forEach((p,b)=>{if(p.intentAlbumInfos&&p.intentAlbumInfos.length>0){const _=[];p.intentAlbumInfos.forEach(u=>{u.img=u.img.replace(".jpg","_579_772.jpg");const d={};d.albumInfo=u,_.push(d)}),s.data.templates.splice(b,1,..._)}}),e.list=e.list.concat(s.data.templates)):E.error({message:"已经到底，没有数据了！",offset:100})}).catch(s=>{console.error("Error:",s),E.error({message:s,offset:100})})}else e.pageNum=0,k()},w=o=>{e.scrollTopValue=o.scrollTop},v=U(),m=()=>{e.scrollTopValue>0&&(window.requestAnimationFrame(m),v.value.setScrollTop(0))},N=q(),T=o=>{const t=JSON.stringify(o);N.push({name:"play",state:{params:t}})};return(o,t)=>{const i=O,s=Y,p=G,b=K,_=H,u=W,d=J,V=Q,x=X;return g(),f("div",Z,[a("div",ee,[n(_,{onSubmit:t[3]||(t[3]=L(()=>{},["prevent"]))},{default:c(()=>[n(b,{modelValue:r(e).key,"onUpdate:modelValue":t[1]||(t[1]=l=>r(e).key=l),placeholder:"请输入剧名搜索",clearable:!0,onChange:t[2]||(t[2]=l=>y(l,0))},{append:c(()=>[n(p,{type:"primary",onClick:t[0]||(t[0]=l=>y(r(e).key,0))},{default:c(()=>[n(s,null,{default:c(()=>[n(i)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),a("div",te,[n(d,{ref_key:"scrollbarRef",ref:v,class:"z-p-l-20 z-p-r-20",height:r(e).height,always:"",onScroll:w},{default:c(()=>[I((g(),f("div",oe,[(g(!0),f(D,null,M(r(e).list,l=>{var S;return g(),f("div",{class:"item",key:l.title},[a("div",{class:"image",onClick:ce=>T(l)},[n(u,{src:l.imageUrl||((S=l.albumInfo)==null?void 0:S.img),referrerpolicy:"no-referrer"},null,8,["src"]),le],8,se),a("div",ne,[a("span",{class:"z-line-1",title:l.title||l.albumInfo.title},P(l.title||l.albumInfo.title),9,ae)])])}),128))])),[[x,k]])]),_:1},8,["height"])]),I(a("div",{class:"to-top",onClick:m},[n(s,null,{default:c(()=>[n(V)]),_:1})],512),[[R,r(e).scrollTopValue>600]])])}}});export{me as default};
