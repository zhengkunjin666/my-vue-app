import{d as k,r as I,o as C,a as q,b as V,n as j,c as $,e as _,f as i,g as d,w as S,u as v,i as E,v as A,j as B,k as F,E as L,l as g,F as P,m as R,t as D,q as M}from"./index-DVixZ95O.js";import{_ as O,E as J,a as U}from"./el-image-viewer-Dl7_ofIl.js";import{E as m}from"./el-message-BKesNtiZ.js";const H={class:"z-flex-1 z-flex-col",style:{height:"10%"}},G={id:"scrollbar",class:"z-flex-1 z-m-t-20 z-p-b-20",style:{height:"10%"}},K={class:"list","infinite-scroll-distance":500},Q=["onClick"],W=i("i",null,null,-1),X={class:"z-m-t-10 z-m-b-20"},Y=["title"],ae=k({__name:"TheMovie",setup(Z){const e=I({pageNum:1,pageSize:40,key:"",list:[],scrollTopValue:0,height:"",isFirst:!0});C(()=>{b(),h(),window.addEventListener("resize",h)}),q(()=>{window.removeEventListener("resize",h)}),V(()=>{u.value.setScrollTop(e.scrollTopValue)});const h=()=>{j(()=>{const a=document.getElementById("scrollbar");e.height=(a==null?void 0:a.getBoundingClientRect().height)+"px"})},y=()=>{e.isFirst||(e.pageNum++,e.key?z(e.key,e.pageNum):b())},b=()=>{const a="https://pbaccess.video.qq.com/trpc.vector_layout.page_view.PageService/getPage?video_appid=3000010",n={page_context:{page_size:e.pageSize.toString(),page_index:(e.pageNum-1).toString()},page_params:{page_id:"channel_list_second_page",page_type:"operation",channel_id:"100200",filter_params:"itype=-1&iarea=-1&characteristic=-1&iyear=-1&charge=1&sort=75",page:"0"},page_bypass_params:{params:{caller_id:"3000010",data_mode:"default",page_id:"channel_list_second_page",page_type:"operation",platform_id:"2",user_mode:"default"},scene:"operation",abtest_bypass_id:""}};fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(t=>t.json()).then(t=>{console.log("Success:",t),e.pageNum===1&&(e.list=[],r()),e.isFirst=!1;const s=e.pageNum===1?t.data.CardList[1].children_list.list.cards:t.data.CardList[0].children_list.list.cards;e.list=e.list.concat(s)}).catch(t=>{console.error("Error:",t),m.error({message:t,offset:100})})},z=(a,n)=>{if(n||(e.pageNum=1),a){const t=`https://mesh.if.iqiyi.com/portal/lw/search/homePageV3?key=${a}&pageNum=${e.pageNum}&pageSize=40`;fetch(t).then(s=>s.json()).then(s=>{console.log("Success:",s),s.code===0?(e.pageNum===1&&(e.list=[],r()),s.data.templates.forEach((l,c)=>{if(l.intentAlbumInfos&&l.intentAlbumInfos.length>0){const p=[];l.intentAlbumInfos.forEach(o=>{o.img=o.img.replace(".jpg","_579_772.jpg");const f={};f.albumInfo=o,p.push(f)}),s.data.templates.splice(c,1,...p)}}),e.list=e.list.concat(s.data.templates)):m.error({message:"已经到底，没有数据了！",offset:100})}).catch(s=>{console.error("Error:",s),m.error({message:s,offset:100})})}else e.pageNum=0,y()},N=a=>{e.scrollTopValue=a.scrollTop},u=$(),r=()=>{e.scrollTopValue>0&&(window.requestAnimationFrame(r),u.value.setScrollTop(0))},T=B(),{proxy:w}=M(),x=a=>{const n=`https://node.video.qq.com/x/api/float_vinfo2?cid=${a.params.cid}`;w.$jsonp(n).then(t=>{const s=t.c.video_ids[0],l={title:a.params.title,playUrl:`https://v.qq.com/x/cover/${a.params.cid}/${s}.html`},c=JSON.stringify(l);T.push({name:"play",state:{params:c,type:"tencent"}})}).catch(t=>{console.error("Error:",t),m.error({message:t,offset:100})})};return(a,n)=>{const t=J,s=F,l=O,c=L,p=U;return g(),_("div",H,[i("div",G,[d(s,{ref_key:"scrollbarRef",ref:u,class:"z-p-l-20 z-p-r-20",height:v(e).height,always:"",onScroll:N},{default:S(()=>[E((g(),_("div",K,[(g(!0),_(P,null,R(v(e).list,o=>(g(),_("div",{class:"item",key:o.params.title},[i("div",{class:"image",onClick:f=>x(o)},[d(t,{src:o.params.new_pic_vt,referrerpolicy:"no-referrer",lazy:""},null,8,["src"]),W],8,Q),i("div",X,[i("span",{class:"z-line-1",title:o.params.title},D(o.params.title),9,Y)])]))),128))])),[[p,y]])]),_:1},8,["height"])]),E(i("div",{class:"to-top",onClick:r},[d(c,null,{default:S(()=>[d(l)]),_:1})],512),[[A,v(e).scrollTopValue>600]])])}}});export{ae as default};
