import{F}from"./base-DWc1T_OZ.js";import{_ as B,E as I,a as $}from"./el-image-viewer-BXMPGTFq.js";import{E as L}from"./el-scrollbar-Bx6k3odp.js";import{E as j,_ as A,a as M}from"./search-wxyzz1CK.js";import{E as R}from"./el-input-DYpg4z5h.js";import{d as D,S as U,o as O,a as q,a8 as G,A as H,r as J,j as g,M as i,t as r,x as p,Q as P,u,l as E,G as T,a5 as Q,h,F as K,_ as W,L as X}from"./index-D5iT9OGn.js";import{E as z}from"./el-message-nU1Hnnk2.js";const Y={class:"z-flex-1 z-flex-col",style:{height:"10%"}},Z={class:"z-m-t-15"},ee={id:"scrollbar",class:"z-flex-1 z-m-t-20 z-p-b-20",style:{height:"10%"}},te={class:"list","infinite-scroll-distance":500},se=["onClick"],oe=i("i",null,null,-1),le={class:"z-m-t-10 z-m-b-20"},ae=["title"],ge=D({__name:"TheAnimation",setup(re){const e=U({pageNum:1,pageSize:40,key:"",list:[],scrollTopValue:0,height:"",isFirst:!0});O(()=>{S(),m(),window.addEventListener("resize",m)}),q(()=>{window.removeEventListener("resize",m)}),G(()=>{v.value.setScrollTop(e.scrollTopValue)});const m=()=>{H(()=>{const t=document.getElementById("scrollbar");e.height=(t==null?void 0:t.getBoundingClientRect().height)+"px"})},k=()=>{e.isFirst||(e.pageNum++,e.key?y(e.key,e.pageNum):S())},S=()=>{const t=`/pgc/season/index/result?st=4&order=0&season_version=-1&is_finish=-1&copyright=-1&season_status=-1&year=-1&style_id=-1&sort=0&page=${e.pageNum}&season_type=4&pagesize=${e.pageSize}&type=1`;fetch(t).then(s=>s.json()).then(s=>{console.log("Success:",s),e.pageNum===1&&(e.list=[],f()),e.isFirst=!1;const n=s.data.list;e.list=e.list.concat(n)}).catch(s=>{console.error("Error:",s),z.error({message:s,offset:100})})},y=(t,s)=>{if(s||(e.pageNum=1),t){const n=`/search/all?spm_id_from=333.976.0.0&keyword=${t}&search_type=&page=${e.pageNum}&page_size=${e.pageSize}`;fetch(n,{referrer:""}).then(o=>o.json()).then(o=>{if(console.log("Success:",o),o.code===0){e.pageNum===1&&(e.list=[],f());const _=[];Object.keys(o.data.result).forEach(d=>{o.data.result[d]&&o.data.result[d].length>0&&o.data.result[d].forEach(a=>{a.title=a.title&&a.title.replace(/<(.+?)>/g,"")||a.title,e.list.length>0?e.list.filter(c=>c.url&&c.url===a.url||c.arcurl&&c.arcurl===a.arcurl).length===0&&_.push(a):_.push(a)})}),e.list=e.list.concat(_)}else z.error({message:"已经到底，没有数据了！",offset:100})}).catch(o=>{console.error("Error:",o),z.error({message:o,offset:100})})}else e.pageNum=0,k()},w=t=>{e.scrollTopValue=t.scrollTop},v=J(),f=()=>{e.scrollTopValue>0&&(window.requestAnimationFrame(f),v.value.setScrollTop(0))},N=Q(),x=t=>{console.log(t);const s={title:t.title,playUrl:t.link||t.url||t.arcurl},n=JSON.stringify(s);console.log(t.link||t.url||t.arcurl),N.push({name:"play",state:{params:n,type:"bilibili"}})};return(t,s)=>{const n=A,o=F,_=M,d=R,a=j,b=I,c=L,V=B,C=$;return h(),g("div",Y,[i("div",Z,[r(a,{onSubmit:s[3]||(s[3]=P(()=>{},["prevent"]))},{default:p(()=>[r(d,{modelValue:u(e).key,"onUpdate:modelValue":s[1]||(s[1]=l=>u(e).key=l),placeholder:"请输入剧名搜索",clearable:!0,onChange:s[2]||(s[2]=l=>y(l,0))},{append:p(()=>[r(_,{type:"primary",onClick:s[0]||(s[0]=l=>y(u(e).key,0))},{default:p(()=>[r(o,null,{default:p(()=>[r(n)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),i("div",ee,[r(c,{ref_key:"scrollbarRef",ref:v,class:"z-p-l-20 z-p-r-20",height:u(e).height,always:"",onScroll:w},{default:p(()=>[E((h(),g("div",te,[(h(!0),g(K,null,W(u(e).list,l=>E((h(),g("div",{class:"item",key:l.title},[i("div",{class:"image",onClick:ne=>x(l)},[r(b,{src:l.cover||l.pic,referrerpolicy:"no-referrer",lazy:""},null,8,["src"]),oe],8,se),i("div",le,[i("span",{class:"z-line-1",title:l.title},X(l.title),9,ae)])])),[[T,l.title]])),128))])),[[C,k]])]),_:1},8,["height"])]),E(i("div",{class:"to-top",onClick:f},[r(o,null,{default:p(()=>[r(V)]),_:1})],512),[[T,u(e).scrollTopValue>600]])])}}});export{ge as default};
